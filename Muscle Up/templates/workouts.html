<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="Content-Security-Policy" content="default-src *; style-src 'self' 'unsafe-inline'; script-src 'self' 'unsafe-inline'; connect-src *;">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <title>Muscle Up | Training</title>
</head>
<body>
<div class="wrapper">
    <header class="head">
        <h1 class="headline">Training</h1>
        <div class="nav-bar">
            <h1 class="headline">Muscle Up</h1>

            <nav class="nav-top">
                <a href="{{ url_for('index') }}" class="link">Home</a>
                <a href="{{ url_for('profile') }}" class="link">Mein Profil</a>
                <a href="{{ url_for('fitness_kalendar') }}" class="link">Fitness Kalender</a>
            </nav>

            {% if 'user_id' in session %}
            <div class="nav-user">
                <div class="dropdown">
                    <button class="dropbtn">
                        <img src="{{ url_for('static', filename='default.png.png') }}" 
                             alt="Profil" class="profile-pic">
                    </button>
                    <div class="dropdown-content">
                        <span class="username">{{ session['username'] }}</span>
                        <a href="{{ url_for('profile') }}">Mein Profil</a>
                        <a href="{{ url_for('logout') }}">Logout</a>
                    </div>
                </div>
            </div>
            {% else %}
            <nav class="nav-top">
                <a href="{{ url_for('login') }}">Login</a>
                <a href="{{ url_for('register') }}">Registrieren</a>
            </nav>
            {% endif %}

            <button class="hamburger" onclick="toggleMenu()">☰</button>
        </div>

        <nav class="mobile-menu" id="mobileMenu">
            <a href="{{ url_for('index') }}">Start</a>
            <a href="{{ url_for('fitness_kalendar') }}">Fitness Kalender</a>

            {% if 'user_id' in session %}
                <a href="{{ url_for('profile') }}">Mein Profil</a>
                <a href="{{ url_for('logout') }}">Logout</a>
            {% else %}
                <a href="{{ url_for('login') }}">Login</a>
                <a href="{{ url_for('register') }}">Registrieren</a>
            {% endif %}
        </nav>
    </header>

    <main class="content">
        <div id="btn-row">
            <button id="kraft-training-btn">Kraft Training</button>
            <button id="cardio-btn">Cardio</button>
        </div>
        
        <!--Cardio-->
        <div id="cardio">

        </div>
        <!--Kraft Training-->
        <div id="kraft-training">
            <form id="exercise-form" class="form-login">
                <input type="text" id="exercise-name" placeholder="Übung eingeben" required>
                <button type="submit">Übung starten</button>
            </form>
            {% if ruhe == True %}
                <form method="post" action="{{ url_for('post_restday') }}">
                    <button type="submit" id="rest-btn" class="button">Restday</button>
                </form>
            {% endif %}
    
            <div id="exercise-container" style="display:none;">
                <h2 id="current-exercise"></h2>
                <form id="set-form" class="form-login">
                    <input type="number" id="weight" placeholder="Gewicht (kg)" required>
                    <input type="number" id="reps" placeholder="Wiederholungen" required>
                    <button type="submit" class="button">Satz hinzufügen</button>
                </form>
                <ul id="sets-list"></ul>
                <button id="finish-exercise" class="button">Übung beenden</button>
            </div>
    
            <div id="workout-overview">
                <h3>Heutige Übungen</h3>
                <div id="completed-exercises">
                    {% for exercise in today_workouts %}
                    <div class="completed-exercise">
                        <h4>{{ exercise.exercise }}</h4>
                        <ul>
                            {% for s in exercise.sets %}
                            <li>Gewicht: {{ s.weight }} kg | Wiederholungen: {{ s.reps }}</li>
                            {% endfor %}
                        </ul>
                        <form method="post" action="{{ url_for('delete_workout', workout_id=exercise.id) }}">
                            <button type="submit" class="button">Löschen</button>
                        </form>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </main>

    <footer>
        &copy; 2025 Muscle Up. Alle Rechte vorbehalten.
    </footer>
</div>

<script>
    document.getElementById("kraft-training-btn").addEventListener("click", () => {
    document.getElementById("kraft-training").style.display = "block";
    document.getElementById("cardio").style.display = "none";
});

document.getElementById("cardio-btn").addEventListener("click", () => {
    document.getElementById("kraft-training").style.display = "none";
    document.getElementById("cardio").style.display = "block";
});
    
    document.addEventListener("DOMContentLoaded", () => {
        let currentExercise = null;
        let currentSets = [];

        const exerciseForm = document.getElementById("exercise-form");
        const setForm = document.getElementById("set-form");
        const exerciseContainer = document.getElementById("exercise-container");
        const currentExerciseTitle = document.getElementById("current-exercise");
        const setsList = document.getElementById("sets-list");

        exerciseForm.addEventListener("submit", (e) => {
            e.preventDefault();
            currentExercise = document.getElementById("exercise-name").value.trim();
            if (!currentExercise) return;
            currentExerciseTitle.textContent = currentExercise;
            exerciseContainer.style.display = "block";
            setsList.innerHTML = "";
            currentSets = [];
            exerciseForm.reset();
        });

        setForm.addEventListener("submit", (e) => {
            e.preventDefault();
            const weight = document.getElementById("weight").value;
            const reps = document.getElementById("reps").value;
            if (!weight || !reps) return;

            const setObj = { weight, reps };
            currentSets.push(setObj);

            const li = document.createElement("li");
            li.textContent = `Gewicht: ${weight} kg | Wiederholungen: ${reps}`;
            const delBtn = document.createElement("button");
            delBtn.textContent = "Löschen";
            delBtn.onclick = () => {
                setsList.removeChild(li);
                currentSets = currentSets.filter(s => s !== setObj);
            };
            li.appendChild(delBtn);
            setsList.appendChild(li);

            setForm.reset();
        });

        document.getElementById("finish-exercise").addEventListener("click", () => {
            if (!currentExercise || currentSets.length === 0) return;

            const workoutData = {
                exercise_name: currentExercise,
                sets: currentSets
            };

            fetch('/workout', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify(workoutData)
            })
            .then(response => {
                if (response.ok) {
                    // Zurücksetzen des Zustands nur bei Erfolg
                    currentExercise = null;
                    currentSets = [];
                    exerciseContainer.style.display = "none";
                    window.location.reload();
                } else {
                    console.error('Fehler beim Speichern des Workouts.');
                }
            })
            .catch(error => {
                console.error('Netzwerkfehler:', error);
            });
        });
    });

    function toggleMenu() {
        const menu = document.getElementById("mobileMenu");
        menu.style.display = (menu.style.display === "flex") ? "none" : "flex";
    }
</script>
</body>
</html>


